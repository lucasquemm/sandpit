function e(e,t,o,c){Object.defineProperty(e,t,{get:o,set:c,enumerable:!0,configurable:!0})}var t={};e(t,"draw",(()=>K)),e(t,"getUpperBound",(()=>J)),e(t,"neighbors",(()=>$)),e(t,"init",(()=>z)),e(t,"refreshUpperBound",(()=>Q)),e(t,"update",(()=>H)),e(t,"getActive",(()=>V));var o={};e(o,"update",(()=>q)),e(o,"make",(()=>L)),e(o,"NAME",(()=>x));const c=()=>({type:"EMPTY",clock:0});var r={};e(r,"NAME",(()=>g)),e(r,"make",(()=>S)),e(r,"update",(()=>A));const n=(...e)=>Math.round(((e,t=0)=>Math.random()*(e-t)+t)(...e)),i=e=>e[n(e.length-1,0)],s=e=>Math.random()<e,a=({type:e,color:t,...o})=>({type:e,clock:0,colorInput:t,color:l(t),...o}),l=e=>`hsl(${e[0]}deg ${e[1]}% ${n(e[2],e[3])}%)`;var d={};e(d,"update",(()=>Y)),e(d,"make",(()=>T)),e(d,"NAME",(()=>f));var y={};e(y,"NAME",(()=>p)),e(y,"make",(()=>E));const p="WOOD",E=()=>a({type:p,color:[33,41,30,15]});var u={};e(u,"make",(()=>m)),e(u,"NAME",(()=>k)),e(u,"update",(()=>v));const k="SMOKE",m=()=>a({type:k,direction:i([1,-1]),color:[4,2,79,90]}),v=(e,t)=>{const o=e.get(0,-1);switch(s(.015)&&e.set(0,0,{type:"EMPTY",clock:0}),o.type){case"EMPTY":s(.95)?e.move(0,-1):e.is(t.direction,1,"EMPTY")&&e.move(t.direction,-1);break;case g:e.move(0,-1)}s(.5)&&e.is(t.direction,0,"EMPTY")?e.move(t.direction,0):t.direction*=-1},f="FIRE",M=[35,76,62,72],h=[35,79,67,77],b=[7,82,56,66],w=[7,82,49,59],P=[7,87,33,43],T=(e="spark")=>a({type:f,phase:e,direction:i([1,-1]),color:i([M,h,b,w,P])}),Y=(e,t)=>{switch(t.phase){case"spark":s(.2)&&e.set(0,0,{type:"EMPTY",clock:0}),s(.73)&&e.is(0,-1,"EMPTY")?e.move(0,-1):e.is(t.direction,-1,"EMPTY")&&e.move(t.direction,-1),s(.75)&&e.is(t.direction,0,"EMPTY")?e.move(t.direction,0):t.direction*=-1,(e=>{let t;for(let[o,c]of e.neighbors(1))if(s(1)&&e.is(o,c,p)){t=[o,c];break}t&&(e.set(...t,T("blaze")),e.set(0,0,{type:"EMPTY",clock:0}))})(e);break;case"blaze":if(((e,t)=>{let o;for(let[c,r]of e.neighbors(2))if(s(t)&&e.is(c,r,p)){o=[c,r];break}o&&e.set(...o,T("blaze"))})(e,.01),s(.01))return void e.set(0,0,m());e.is(0,-1,"EMPTY")&&(s(.06)?e.set(0,-1,T()):s(.15)&&e.set(0,-1,m()));let o=!0;for(let[t,c]of e.neighbors(1))if(!e.is(t,c,"EMPTY")){o=!1;break}o&&e.set(0,0,{type:"EMPTY",clock:0})}},g="WATER",S=()=>a({type:g,direction:i([1,-1]),color:[216,65,60,50]}),A=(e,t)=>{switch(e.get(0,1).type){case f:case"EMPTY":e.move(0,1);break;case g:e.is(t.direction,1,"EMPTY")&&e.move(t.direction,1)}e.is(t.direction,0,"EMPTY")||e.is(t.direction,0,f)?e.move(t.direction,0):t.direction*=-1,s(.005)&&(e=>{e.color=l(e.colorInput)})(t)},x="SAND",L=()=>a({type:x,color:[46,78,75,50]}),q=e=>{const t=e.get(0,1),o=i([1,-1]);switch(t.type){case"EMPTY":e.move(0,1);break;case g:e.swap(0,1);break;case x:e.is(o,1,"EMPTY")&&e.move(o,1)}};let N,B,D,U,R=[],O=0;const z=(e=100)=>{N=1,boundingY=e,D={x:0,y:e},B=D,O=e,R=Array.from({length:O*O},(()=>({type:"EMPTY",clock:0})))},G=(e,t)=>e<0||t<0||e>=O||t>=O?{type:"BOUNDS"}:R[j(e,t)],I=(e,t,o={type:"EMPTY",clock:0})=>{const c=j(e,t);o.clock=N+1,R[c]=o,t<B.y&&(B={x:e,y:t})},$=(e=1)=>Array.from({length:e},((e,t)=>{const o=t+1;return[[-1*o,-1*o],[-1*o,0],[-1*o,1*o],[0,-1*o],[0,1*o],[1*o,-1*o],[1*o,0],[1*o,1*o]]})).flat(),F=(e,t)=>({is:(o,c,r)=>G(e+o,t+c).type===r,move:(o,c)=>{const r=G(e,t);r.clock>N||(I(e+o,t+c,r),I(e,t,{type:"EMPTY",clock:0}))},swap:(o,c)=>{const r=G(e,t);if(r.clock>N)return;const n=e+o,i=t+c,s=G(n,i);I(n,i,r),I(e,t,s)},set:(o,c,r)=>I(e+o,t+c,r),get:(o,c)=>G(e+o,t+c),neighbors:$}),W=F(0,0),j=(e,t)=>e*O+t,C=e=>{const t=e%O;return[(e-t)/O,t]},K=(e,t,o)=>{if("EMPTY"===o.type||W.is(e,t,"EMPTY")){const c=j(e,t);o.clock=N,R[c]=o,t<B.y&&(B={x:e,y:t})}},H=()=>{U={};for(let e=0,t=R.length;e<t;e++){const[t,o]=C(e),c=R[e];"EMPTY"!==c.type&&(c.color in U?U[c.color].push({x:t,y:o,cell:c}):U[c.color]=[{x:t,y:o,cell:c}]);const r=F(t,o);switch(c.type){case x:q(r,c);break;case g:A(r,c);break;case k:v(r,c);break;case f:Y(r,c)}}N++},J=()=>B.y,Q=()=>{W.is(B.x,B.y,"EMPTY")&&(B=D)},V=()=>U,X=document.querySelector("canvas"),Z=X.getContext("2d",{alpha:!1}),_=window.devicePixelRatio||1;X.width=500*_,X.height=500*_,X.style.width="500px",X.style.height="500px",Z.scale(_,_),Z.fillStyle="white",Z.fillRect(0,0,500,500);var ee={};e(ee,"NAME",(()=>te)),e(ee,"make",(()=>oe));const te="STONE",oe=()=>a({type:te,color:[0,0,60,40]});window.DEBUG=!1;let ce,re,ne,ie;const se=()=>{t.update(),(e=>{const t=5*e.getUpperBound()-5;Z.fillStyle="white",Z.fillRect(0,t,500,500-t),window.DEBUG&&(Z.fillStyle="red",Z.fillRect(0,t,500,1));const o=e.getActive();for(let e in o){Z.fillStyle=e;const t=o[e];for(let{x:e,y:o}of t)Z.fillRect(5*e,5*o,5,5)}e.refreshUpperBound()})(t)},ae=()=>{requestAnimationFrame(ae),ce=Date.now(),re=ce-ne,re>ie&&(ne=ce-re%ie,se())},le=document.querySelector("#canvas");let de=!1;const ye=e=>Math.floor(e/5),pe=e=>{(e=>{const t=ye(e.x),o=ye(e.y);return[[t,o],[t+1,o],[t-1,o],[t,o+1],[t,o-1]]})(e).forEach((e=>t.draw(...e,we())))};le.addEventListener("mousemove",(e=>{de&&pe(e)})),le.addEventListener("click",pe),le.addEventListener("mousedown",(()=>{de=!0})),le.addEventListener("mouseup",(()=>{de=!1}));let Ee="sand";const ue=document.querySelector("#pedra-btn"),ke=document.querySelector("#areia-btn"),me=document.querySelector("#ar-btn"),ve=document.querySelector("#water-btn"),fe=document.querySelector("#smoke-btn"),Me=document.querySelector("#wood-btn"),he=document.querySelector("#fire-btn"),be={sand:o,stone:ee,empty:{make:c},water:r,smoke:u,wood:y,fire:d},we=()=>be[Ee].make();ue.addEventListener("click",(()=>Ee="stone")),ke.addEventListener("click",(()=>Ee="sand")),me.addEventListener("click",(()=>Ee="empty")),ve.addEventListener("click",(()=>Ee="water")),fe.addEventListener("click",(()=>Ee="smoke")),Me.addEventListener("click",(()=>Ee="wood")),he.addEventListener("click",(()=>Ee="fire")),document.querySelector("#tick").addEventListener("click",se),t.init(),window.DEBUG||(ie=1e3/60,ne=Date.now(),ae());
//# sourceMappingURL=index.76e38cee.js.map
